<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<link rel=canonical href=https://vranix.com/2022/nix-devshells/>
<link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<title>
Nix dev shells from 10,000 feet | vranix
</title>
<meta name=title content="Nix dev shells from 10,000 feet | vranix">
<link rel=stylesheet href=/font/iconfont.css>
<link rel=stylesheet href=/css/main.min.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Nix dev shells from 10,000 feet">
<meta name=twitter:description content="Setting the scene After neglecting this small place on the internet for years, I cloned the repo with the hope of quickly updating my resume. This site is constructed with Hugo, which is a static site generator written in golang. Anyway, I needed to install that too, so I edited my home-manager configuration and switched, i.e., I installed it.
There was an attempt First thing I tried was running &ldquo;hugo serve&rdquo; which starts a web server and serves the content of your hugo project so changes can be seen as you make them.">
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Nix dev shells from 10,000 feet","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/vranix.com\/2022\/nix-devshells\/"},"genre":"posts","wordcount":584,"url":"https:\/\/vranix.com\/2022\/nix-devshells\/","datePublished":"2022-03-09T12:37:53-08:00","dateModified":"2022-03-09T12:37:53-08:00","description":""}</script>
</head>
<body>
<div class=wrapper>
<nav class=navbar>
<div class=container>
<div class="navbar-header header-logo">
<a href=https://vranix.com/>vranix</a>
</div>
<div class="menu navbar-right">
<a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/about title>About</a>
<a class=menu-item href=/resume title>Resume</a>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-sun"></i></a>&nbsp;
</div>
</div>
</nav>
<nav class=navbar-mobile id=nav-mobile style=display:none>
<div class=container>
<div class=navbar-header>
<div> <a href=javascript:void(0); class=theme-switch><i class="iconfont icon-sun"></i></a>&nbsp;<a href=https://vranix.com/>vranix</a></div>
<div class=menu-toggle>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=mobile-menu>
<a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/about title>About</a>
<a class=menu-item href=/resume title>Resume</a>
</div>
</div>
</nav>
<main class=main>
<div class=container>
<article class=post-warp>
<header class=post-header>
<h1 class=post-title>Nix dev shells from 10,000 feet</h1>
<div class=post-meta>
Written by <a href=https://vranix.com/ rel=author>svrana</a> with â™¥
<span class=post-time>
on <time datetime=2022-03-09>9 March 2022</time>
</span>
in
<i class="iconfont icon-timer"></i>
3 min
</div>
</header>
<div class=post-content>
<h2 id=setting-the-scene>Setting the scene</h2>
<p>After neglecting this small place on the internet for years, I cloned the repo with the
hope of quickly updating my resume. This site is constructed with <a href=https://gohugo.io>Hugo</a>,
which is a static site generator written in golang. Anyway, I needed to install that too, so I
edited my <a href=https://github.com/nix-community/home-manager>home-manager</a> configuration and <a href=https://github.com/svrana/nix-home/blob/main/Makefile#L26>switched</a>,
i.e., I installed it.</p>
<h2 id=there-was-an-attempt>There was an attempt</h2>
<p>First thing I tried was running &ldquo;hugo serve&rdquo; which starts a web server and serves the
content of your hugo project so changes can be seen as you make them. But that failed. I
don&rsquo;t remember the errors; it&rsquo;s not important, I knew what happened- years had passed,
non-backward compatible changes had been made to hugo and something I was doing no longer worked.
That&rsquo;s one way of putting it. The more correct way of putting it is that I was using a
much newer version of hugo for a website that was created using a previous version. This was
my own mistake and this wasn&rsquo;t going to happen again. This time I would fix the glitch.</p>
<h2 id=enter-nix>Enter Nix</h2>
<p>I created a flake.nix in the root of my project directory with the following contents.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix>{
  description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;my hugo flake with a shell&#34;</span>;
  inputs<span style=color:#f92672>.</span>nixpkgs<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:NixOS/nixpkgs/nixpkgs-unstable&#34;</span>;
  inputs<span style=color:#f92672>.</span>flake-utils<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:numtide/flake-utils&#34;</span>;

  outputs <span style=color:#f92672>=</span> { self<span style=color:#f92672>,</span> nixpkgs<span style=color:#f92672>,</span> flake-utils }:
    flake-utils<span style=color:#f92672>.</span>lib<span style=color:#f92672>.</span>eachDefaultSystem (system:
      <span style=color:#66d9ef>let</span>
        pkgs <span style=color:#f92672>=</span> nixpkgs<span style=color:#f92672>.</span>legacyPackages<span style=color:#f92672>.</span><span style=color:#e6db74>${</span>system<span style=color:#e6db74>}</span>;
      <span style=color:#66d9ef>in</span>
      {
        devShell <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>mkShell {
          nativeBuildInputs <span style=color:#f92672>=</span> [ pkgs<span style=color:#f92672>.</span>bashInteractive ];
<span style=display:block;width:100%;background-color:#3c3d38>          buildInputs <span style=color:#f92672>=</span> <span style=color:#66d9ef>with</span> pkgs; [ hugo awscli2 ];
</span>        };
      });
}
</code></pre></div><p>This flake isn&rsquo;t any good. I don&rsquo;t even automate the build, but it does what exactly what
I need. It pins the dependencies I need to build and deploy my project, hugo and awscli2.</p>
<p>I also added a .envrc file with the following contents:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash> <span style=color:#66d9ef>if</span> ! has nix_direnv_version <span style=color:#f92672>||</span> ! nix_direnv_version 1.6.0; <span style=color:#66d9ef>then</span>
      source_url <span style=color:#e6db74>&#34;https://raw.githubusercontent.com/nix-community/nix-direnv/1.6.0/direnvrc&#34;</span> <span style=color:#e6db74>&#34;sha256-FqqbUyxL8MZdXe5LkMgtNo95raZFbegFpl5k2+Pr
</span><span style=color:#e6db74>  Cow=&#34;</span>
  <span style=color:#66d9ef>fi</span>

 use flake
</code></pre></div><p>Now, assuming you have <a href=https://github.com/nix-community/nix-direnv>nix-direnv</a> you will
be dropped into a shell with your dependencies each time you enter your project directory.
In this particular case I&rsquo;m using the version numbers of hugo and awscli2 as supplied by
nixpkgs-unstable. This isn&rsquo;t the only way to do this; you could have pinned to a
particular version of hugo or awscliv2, but this is good enough for this simple project. A
flake.lock file that describes how nix understands the dependencies is generated the first
time you enter the directory:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix>    <span style=color:#e6db74>&#34;nixpkgs&#34;</span>: {
      <span style=color:#e6db74>&#34;locked&#34;</span>: {
        <span style=color:#e6db74>&#34;lastModified&#34;</span>: <span style=color:#ae81ff>1644972330</span><span style=color:#f92672>,</span>
        <span style=color:#e6db74>&#34;narHash&#34;</span>: <span style=color:#e6db74>&#34;sha256-6V2JFpTUzB9G+KcqtUR1yl7f6rd9495YrFECslEmbGw=&#34;</span><span style=color:#f92672>,</span>
        <span style=color:#e6db74>&#34;owner&#34;</span>: <span style=color:#e6db74>&#34;NixOS&#34;</span><span style=color:#f92672>,</span>
        <span style=color:#e6db74>&#34;repo&#34;</span>: <span style=color:#e6db74>&#34;nixpkgs&#34;</span><span style=color:#f92672>,</span>
<span style=display:block;width:100%;background-color:#3c3d38>        <span style=color:#e6db74>&#34;rev&#34;</span>: <span style=color:#e6db74>&#34;19574af0af3ffaf7c9e359744ed32556f34536bd&#34;</span><span style=color:#f92672>,</span>
</span>        <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;github&#34;</span>
      }<span style=color:#f92672>,</span>
</code></pre></div><p>I&rsquo;ve abbreviated it, but you can see the git sha of the nixpkgs repo to which we are
pinned. nixpkgs (<a href=https://github.com/nixpkgs>https://github.com/nixpkgs</a>) is the repo that holds our dependencies (and
80k+ software packages for nix) and the instructions of how to build them for the nix
package manager.</p>
<h2 id=faster>Faster</h2>
<p>Of course constructing your flake and .envrc is a lot of work, which is why I didn&rsquo;t do it
by hand. Intead, I ran <a href=https://github.com/nix-community/nix-direnv#shell-integration>flakify</a>. From there I
just added my two dependencies to the dev shell. &lsquo;Course you have to have nix and
nix-direnv installed.</p>
<h2 id=this-fixes-nothing>This fixes nothing</h2>
<p>So, yeah, I still had to change my website code to work with the new version of hugo I
pulled in from nixpkgs. But from now on, I can choose when I want to do that, by
updating the dependencies at a time of my choosing.</p>
<h2 id=afterward>Afterward</h2>
<p>Nix flakes provide a lot more than developer shells. If you&rsquo;d like to learn more, check
out Xe&rsquo;s <a href=https://christine.website/blog/nix-flakes-1-2022-02-21>intro to flakes</a> and
follow that up with xer <a href=https://christine.website/blog/nix-flakes-2-2022-02-27>flake packages</a>.</p>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span>Author:</span>
<span>svrana </span>
</p>
<p class=copyright-item>
<span>Words:</span>
<span>584</span>
</p>
<p class=copyright-item>
</p>
</div>
<div class=post-tags>
<section>
<a href=javascript:window.history.back();>Back</a></span> Â·
<span><a href=https://vranix.com/>Home</a></span>
</section>
</div>
<div class=post-nav>
</div>
<div class=post-comment>
</div>
</article>
</div>
</main>
<script src=/js/vendor_no_gallery.min.js async></script>
</div>
</body>
</html>